/*! PS Mitgliedschaften - v1.1.8
 * https://n3rds.work/docs/ps-mitgliedschaften-plugin-handbuch/
 * Copyright (c) 2019-2024; * Licensed GPLv2+ */
function escapeHtml(e){var i=document.createElement("div");return i.appendChild(document.createTextNode(e)),i.innerHTML}window.ms_init=window.ms_init||{},jQuery((function(){var e;function i(e){if(void 0!==e&&void 0!==window.ms_init[e]){if(!0===window.ms_init._done[e])return!1;window.ms_init._done[e]=!0,window.ms_init[e]()}}if(window.ms_init._done=window.ms_init._done||{},void 0!==window.ms_data&&void 0!==ms_data.ms_init){if(ms_data.ms_init instanceof Array)for(e=0;e<ms_data.ms_init.length;e+=1)i(ms_data.ms_init[e]);else i(ms_data.ms_init);ms_data.ms_init=[]}})),window.ms_functions={dp_config:{dateFormat:"yy-mm-dd",dayNamesMin:["Sun","Mon","Tue","Wed","Thy","Fri","Sat"],custom_class:"wpmui-datepicker"},chosen_options:{minimumResultsForSearch:6,width:"auto"},init:function(e){var i=window.ms_functions;jQuery(".ms-wrap select, .ms-select",e).each((function(){var e=jQuery(this);e.closest(".no-auto-init").length||e.closest(".manual-init").length||e.wpmuiSelect(i.chosen_options)})),jQuery(".wpmui-datepicker",e).each((function(){var e=jQuery(this);e.closest(".no-auto-init").length||e.ms_datepicker()})),window.setTimeout((function(){jQuery("body").trigger("resize")}),50)},ajax_update:function(e){var i,t,a,n=jQuery(e),s=window.ms_functions,r=n;n.hasClass("ms-processing")||(r.parents(".wpmui-radio-wrapper").length?r=r.parents(".wpmui-radio-wrapper").first():r.parents(".wpmui-radio-slider-wrapper").length?r=r.parents(".wpmui-radio-slider-wrapper").first():r.parents(".wpmui-input-wrapper").length?r=r.parents(".wpmui-input-wrapper").first():r.parents(".wpmui-select-wrapper").length?r=r.parents(".wpmui-select-wrapper").first():r.parents("label").length&&(r=r.parents("label").first()),r.addClass("wpmui-loading"),a=s.ajax_show_indicator(n),i=n.data("wpmui-ajax"),n.is(":checkbox")?i.value=n.prop("checked"):(t=n.val())instanceof Array||t instanceof Object||null===t?i.values=t:i.value=t,void 0===i.field&&(i.field=n.attr("name")),"function"==typeof n.data("before_ajax")&&(i=n.data("before_ajax")(i,n)),n.trigger("ms-ajax-start",[i,a,r]),jQuery.post(window.ajaxurl,i,(function(e){var t=s.ajax_error(e,a);r.removeClass("wpmui-loading"),a.removeClass("ms-processing"),n.trigger("ms-ajax-updated",[i,e,t])})).always((function(){n.trigger("ms-ajax-done",[i,a,r])})))},radio_slider_ajax_update:function(e){var i,t,a,n,s,r=jQuery(e),o=window.ms_functions;r.hasClass("ms-processing")||r.attr("readonly")||(r.toggleClass("on"),r.toggleClass("off"),r.parent().toggleClass("on"),r.parent().toggleClass("off"),r.trigger("change"),a=r.children(".wpmui-toggle"),i=a.data("wpmui-ajax"),n=a.data("states"),null!=i?(t=o.ajax_show_indicator(r),r.addClass("ms-processing wpmui-loading"),s=r.hasClass("on"),void 0!==n.active&&s?i.value=n.active:void 0===n.inactive||s?i.value=s:i.value=n.inactive,"function"==typeof r.data("before_ajax")&&(i=r.data("before_ajax")(i,r)),r.trigger("ms-ajax-start",[i,t,r]),jQuery.post(window.ajaxurl,i,(function(e){var a=o.ajax_error(e,t);a&&(r.toggleClass("on"),r.toggleClass("off")),t.removeClass("ms-processing"),r.removeClass("ms-processing wpmui-loading"),r.children("input").val(r.hasClass("on")),i.response=e,r.trigger("ms-ajax-updated",[i,e,a]),r.trigger("ms-radio-slider-updated",[i,a]),r.trigger("wpmui-radio-slider-updated",[i,a])})).always((function(){r.trigger("ms-ajax-done",[i,t,r])}))):r.children("input").val(r.hasClass("on")))},dynamic_form_submit:function(e,i){var t,a,n,s,r,o,d=window.ms_functions,l=jQuery(i),u=l.serializeArray(),m={};for(e.preventDefault(),t=0;t<u.length;t+=1)n=u[t].name,a=u[t].value,void 0===m[n]?m[n]=a:(m[n]instanceof Array||(m[n]=[m[n]]),m[n].push(a));return m.action="ms_submit",o=l.parents(".wpmui-popup"),(s=o.length)?o.addClass("wpmui-loading"):r=d.ajax_show_indicator(l),jQuery(document).trigger("ms-ajax-form-send",[l,m,s,r]),jQuery.post(window.ajaxurl,m,(function(e){var i=d.ajax_error(e,r);o.length&&o.removeClass("wpmui-loading"),i||s&&d.close_dialogs(),jQuery(document).trigger("ms-ajax-form-done",[l,e,i,m,s,r])})),!1},ajax_error:function(e,i){var t=0,a=[],n="",s=window.ms_functions;return isNaN(e)?(a=e.split(":",2),isNaN(a[0])||(t=a[0]),void 0!==a[1]&&(n=a[1])):t=e,t<0?(i&&(i.removeClass("okay").addClass("error"),i.find(".err-code").text(n),s.ajax_hide_message(8e3,i)),!0):(i&&(i.removeClass("error").addClass("okay"),i.find(".err-code").text(""),s.ajax_hide_message(4e3,i)),!1)},ajax_show_indicator:function(e){var i;window.ms_functions;return null!==(i=e.closest(".ms-save-text-wrapper")).data("msg_timeout")&&(window.clearTimeout(i.data("msg_timeout")),i.data("msg_timeout",null)),i.addClass("ms-processing"),i.removeClass("error okay"),i},ajax_hide_message:function(e,i){var t;window.ms_functions;isNaN(e)&&(e=4e3),e<0&&(e=0),t=window.setTimeout((function(){i.removeClass("error okay")}),e),i.data("msg_timeout",t)},select_all:function(e){var i;e=jQuery(e)[0],document.selection?((i=document.body.createTextRange()).moveToElementText(e),i.select()):window.getSelection&&((i=document.createRange()).selectNode(e),window.getSelection().addRange(i))},toggle_box:function(e,i){var t=jQuery(i).closest(".ms-settings-box");if(t.hasClass("static"))return!1;t.hasClass("closed")?t.removeClass("closed").addClass("open"):t.removeClass("open").addClass("closed")},toggle_datepicker:function(e){jQuery(e).closest(".wpmui-datepicker-wrapper").find(".wpmui-datepicker").datepicker("show")},tag_selector_add:function(e){var i=window.ms_functions,t=jQuery(this).closest(".wpmui-tag-selector-wrapper"),a=t.find("select.wpmui-tag-source"),n=t.find("select.wpmui-tag-data"),s=n.val()||[];a.val().length&&(s.push(a.val()),n.val(s).trigger("change"),a.val("").trigger("change"),i.tag_selector_refresh_source(e,this))},tag_selector_refresh_source:function(e,i){var t=0,a=null,n=jQuery(i).closest(".wpmui-tag-selector-wrapper"),s=n.find("select.wpmui-tag-source"),r=s.find("option"),o=n.find("select.wpmui-tag-data").val()||[];for(t=0;t<r.length;t+=1)a=jQuery(r[t]),-1!==jQuery.inArray(a.val(),o)?a.prop("disabled",!0):a.prop("disabled",!1);s.trigger("change")},reload:function(){window.location.reload()},show_dialog:function(e){var i,t=jQuery(this),a=(window.ms_functions,{});if(e.preventDefault(),void 0!==(i=t.attr("data-ms-data")))try{a=jQuery.parseJSON(i)}catch(e){a={}}return a.action="ms_dialog",a.dialog=t.attr("data-ms-dialog"),jQuery(document).trigger("ms-load-dialog",[a]),t.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,a,(function(e){var i=!1;t.removeClass("wpmui-loading");try{i=jQuery.parseJSON(e)}catch(e){i=!1}i.title=i.title||"Dialog",i.height=i.height||100,i.width=i.width>0?i.width:void 0,i.content=i.content||"",i.modal=i.modal||!0,wpmUi.popup().modal(!0,!i.modal).title(i.title).size(i.width,i.height).content(i.content).show()})),!1},close_dialogs:function(){var e,i=wpmUi.popups();for(e in i)i[e].close()},update_view_count:function(e,i,t){var a=jQuery(this).closest(".wp-list-table").closest("form").parent().find(".subsubsub").first(),n=a.find(".has_access .count"),s=a.find(".no_access .count"),r=parseInt(n.text().replace(/\D/,"")),o=parseInt(s.text().replace(/\D/,""));isNaN(r)&&(r=0),isNaN(o)&&(o=0),i.value?(o-=1,r+=1):(o+=1,r-=1),r<0&&(r=0),o<0&&(o=0),0===r?n.text(""):n.text("("+r+")"),0===o?s.text(""):s.text("("+o+")")},submit_form:function(){var e=jQuery(this).data("form"),i=jQuery("form."+e);i.length&&i.submit()}},jQuery.fn.ms_datepicker=function(e){var i=null,t=window.ms_functions,a=jQuery.extend(t.dp_config,e);return"function"==typeof a.beforeShow&&(i=a.beforeShow),a.beforeShow=function(e,t){void 0!==t&&void 0!==t.dpDiv&&jQuery(t.dpDiv).addClass(a.custom_class),window.setTimeout((function(){jQuery(t.dpDiv).css({"z-index":"10"})}),20),null!==i&&i(e,t)},this.each((function(){jQuery(this).datepicker(a)}))},jQuery(document).ready((function(){var e=window.ms_functions;jQuery("body").on("click",".wpmui-radio-slider",(function(i){e.radio_slider_ajax_update(this)})).on("click",".ms-settings-box .handlediv",(function(i){e.toggle_box(i,this)})).on("click",".wpmui-datepicker-wrapper .wpmui-icon",(function(i){e.toggle_datepicker(this)})).on("select2-opening",".wpmui-tag-selector-wrapper .wpmui-tag-data",(function(e){e.preventDefault()})).on("change",".wpmui-tag-selector-wrapper .wpmui-tag-data",(function(i){e.tag_selector_refresh_source(i,this)})).on("click",".wpmui-tag-selector-wrapper .wpmui-tag-button",e.tag_selector_add).on("change","input.wpmui-ajax-update:not([type=number]), select.wpmui-ajax-update, textarea.wpmui-ajax-update",(function(i){e.ajax_update(this)})).on("blur",'input.wpmui-ajax-update[type="number"]',(function(i){var t=jQuery(this);t.val()!==t.data("val")&&(t.data("val",t.val()),e.ajax_update(this))})).on("change",'input.wpmui-ajax-update[type="number"]',(function(e){jQuery(this).focus()})).on("focus",'input.wpmui-ajax-update[type="number"]',(function(e){var i=jQuery(this);void 0===i.data("val")&&i.data("val",i.val())})).on("click","button.wpmui-ajax-update",(function(i){e.ajax_update(this)})).on("submit","form.wpmui-ajax-update",(function(i){e.dynamic_form_submit(i,this)})).on("click","[data-ms-dialog]",e.show_dialog).on("ms-radio-slider-updated",".wp-list-table.rules .wpmui-radio-slider",e.update_view_count).on("click",".ms-submit-form",e.submit_form),jQuery(".ms-wrap").on("click","code",(function(){e.select_all(this)})),e.init("body"),jQuery("html").addClass("ms-html")})),function(){var e=null,i=null,t=null;window.ms_inline_editor={init:function(){(t=jQuery(".ms-wrap #inline-edit")).detach(),t.on("keyup",(function(e){if(27===e.which)return ms_inline_editor.revert()})),jQuery("a.cancel",t).on("click",(function(){return ms_inline_editor.revert()})),jQuery("a.save",t).on("click",(function(){return ms_inline_editor.save(this)})),jQuery("td",t).on("keydown",(function(e){if(13===e.which)return ms_inline_editor.save(this)})),jQuery(".ms-wrap .wp-list-table").on("click","a.editinline",(function(){return ms_inline_editor.edit(this),!1}))},edit:function(a){var n;return ms_inline_editor.revert(),"object"==typeof a&&(a=ms_inline_editor.get_id(a)),e=t.clone(!0),i=jQuery("#item-"+a),jQuery("td",e).attr("colspan",jQuery(".widefat:first thead th:visible").length),i.hasClass("alternate")&&e.addClass("alternate"),i.hide().after(e),n={},i.find(".inline_data").children().each((function(){var i=jQuery(this),t=i.attr("class"),a=e.find(':input[name="'+t+'"]'),s=e.find(".lbl-"+t);n[t]=i.text(),a.length&&a.val(n[t]),s.length&&s.text(n[t])})),jQuery(document).trigger("ms-inline-editor",[e,i,n]),e.attr("id","edit-"+a).addClass("inline-editor").show(),e.find(":input:visible").first().focus(),!1},save:function(t){var a;return"object"==typeof t&&(t=ms_inline_editor.get_id(t)),e.find("td").addClass("wpmui-loading"),a=e.find(":input").serialize(),jQuery.post(window.ajaxurl,a,(function(t){e.find("td").removeClass("wpmui-loading"),t?-1!==t.indexOf("<tr")?(i.remove(),i=jQuery(DOMPurify.sanitize(t)),e.before(i).remove(),i.hide().fadeIn(),ms_inline_editor.update_alternate(i),jQuery(document).trigger("ms-inline-editor-updated",[i])):(t=DOMPurify.sanitize(t).replace(/<.[^<>]*?>/g,""),e.find(".error").text(t).show()):e.find(".error").text(ms_data.lang.quickedit_error).show(),i.prev().hasClass("alternate")&&i.removeClass("alternate")}),"html"),!1},revert:function(){return e&&(e.remove(),i.show(),e=null,i=null),!1},update_alternate:function(e){var i,t,a,n=jQuery(e).closest("tbody").find("tr:visible");for(i=0,t=n.length;i<t;i++)a=jQuery(n[i]),i%2==0?a.addClass("alternate"):a.removeClass("alternate")},get_id:function(e){var i=jQuery(e).closest("tr").attr("id").split("-");return i[i.length-1]}},jQuery((function(){ms_inline_editor.init()}))}(),jQuery((function(){jQuery(document).on("click",(function(){jQuery(".wpmui-tooltip[timestamp]").each((function(){var e=jQuery(this),i=e.attr("timestamp"),t=jQuery('.wpmui-tooltip-wrapper[timestamp="'+i+'"]').first();e.hide(),e.appendTo(jQuery(t))}))})),jQuery(".wpmui-tooltip-button").on("click",(function(){var e=jQuery(this).parents(".wpmui-tooltip"),i=jQuery(e).attr("timestamp"),t=jQuery('.wpmui-tooltip-wrapper[timestamp="'+i+'"]').first();jQuery(e).hide(),jQuery(e).appendTo(jQuery(t))})),jQuery(".wpmui-tooltip").on("click",(function(e){e.stopPropagation()})),jQuery(".wpmui-tooltip-info").on("click",(function(e){var i,t,a,n,s,r=jQuery(this);r.toggleClass("open"),r.hasClass("open")?(r.parents(".wpmui-tooltip-wrapper").attr("timestamp",e.timeStamp),e.stopPropagation(),(s=r.siblings(".wpmui-tooltip")).attr("timestamp",e.timeStamp),n=r.offset(),s.appendTo("#wpcontent"),s.css({left:n.left+25,top:n.top-40}),s.fadeIn(300)):(i=r.parents(".wpmui-tooltip-wrapper"),t=jQuery(i).attr("timestamp"),a=jQuery('.wpmui-tooltip[timestamp="'+t+'"]').first(),jQuery(a).hide(),jQuery(a).appendTo(jQuery(i)))}))})),window.ms_init.controller_adminbar=function(){jQuery("#wp-admin-bar-membership-simulate").find("a").on("click",(function(e){jQuery("#wp-admin-bar-membership-simulate").removeClass("hover").find("> div").filter(":first-child").html(ms_data.switching_text)})),jQuery(".ms-date").ms_datepicker(),jQuery("#wpadminbar #view-site-as").parents("#wpadminbar").addClass("simulation-mode"),jQuery("#wpadminbar #view-as-selector").on("change",(function(e){var i=e.currentTarget.value,t=jQuery("#wpadminbar #view-as-selector").find('option[value="'+i+'"]').attr("nonce");jQuery("#wpadminbar #ab-membership-id").val(i),jQuery("#wpadminbar #view-site-as #_wpnonce").val(t),jQuery("#wpadminbar #view-site-as").submit()}))},window.ms_init.view_help=function(){jQuery(".ms-help-toggle").click((function(){jQuery(this).parents(".ms-help-box").first().find(".ms-help-details").toggle()}))},window.ms_init.view_billing_edit=function(){jQuery(".ms-form").validate({onkeyup:!1,errorClass:"ms-validation-error",rules:{name:"required",user_id:{required:!0,min:1},membership_id:{required:!0,min:1},amount:{required:!0,min:0},due_date:{required:!0,dateISO:!0}}})},window.ms_init.view_billing_transactions=function(){var e,i,t,a=jQuery(".wp-list-table.transactions, .wp-list-table.transaction_matches"),n=jQuery(".transaction-matching"),s=a.find(".action-clear"),r=a.find(".action-ignore"),o=a.find(".action-link"),d=a.find(".action-retry"),l=n.find(".action-match");e=function(){var e=a.find(".item"),i=n.find(".retry_nonce").val(),t=wpmUi.progressbar(),s=0,r={},o=[];r.action="transaction_retry",r._wpnonce=i,e.each((function(){var e=jQuery(this),i=e.attr("id").replace(/^item-/,"");e.find(".column-note").addClass("wpmui-loading"),o.push(i)})),t.value(0),t.max(o.length),t.$().insertBefore(n),n.hide(),function e(){if(o.length){var i=o.shift(),n=jQuery.extend({},r),d=a.find("#item-"+i);n.id=i,s+=1,t.value(s),jQuery.post(window.ajaxurl,n,(function(i){i.success&&i.data.desc&&(d.removeClass("log-err log-ignore log-ok"),d.addClass("log-"+i.data.state),d.find(".column-note .txt").text(i.data.desc)),window.setTimeout((function(){e()}),1)}),"json").always((function(){d.find(".column-note").removeClass("wpmui-loading")}))}else t.$().remove()}()},i=function(e,i){var a,n,s,r,o,d,l,u,m,c=wpmUi.popup(),p=c.$();function w(){var e,i=a.val();if(isNaN(i)||i<1)return l.find(".wpmui-label-after").hide(),d.hide(),l.hide(),!1;e={action:"transaction_link_data",_wpnonce:r.val(),get:"subscriptions",for:i},n.empty(),s.empty(),d.show().addClass("wpmui-loading"),l.find(".wpmui-label-after").hide(),l.hide(),u.prop("disabled",!0).addClass("disabled"),jQuery.post(window.ajaxurl,e,(function(e){jQuery.each(e,(function(e,i){t(n,e,i)}))}),"json").always((function(){d.removeClass("wpmui-loading")}))}c.modal(!0),c.title(ms_data.lang.link_title),c.content(i),c.show(),a=p.find("select[name=user_id]"),n=p.find("select[name=subscription_id]"),s=p.find("select[name=invoice_id]"),p.find(".link-member"),d=p.find(".link-subscription"),l=p.find(".link-invoice"),r=p.find("input[name=nonce_link_data]"),o=p.find("input[name=nonce_update]"),m=p.find("input[name=log_id]"),u=p.find("button[name=submit]"),d.hide(),l.hide(),u.prop("disabled",!0).addClass("disabled"),a.change(w),n.change((function(){var e,i=n.val();if(isNaN(i)||i<1)return l.find(".wpmui-label-after").hide(),l.hide(),!1;e={action:"transaction_link_data",_wpnonce:r.val(),get:"invoices",for:i},s.empty(),l.show().addClass("wpmui-loading"),l.find(".wpmui-label-after").hide(),u.prop("disabled",!0).addClass("disabled"),jQuery.post(window.ajaxurl,e,(function(e){window.console.log(e),jQuery.each(e,(function(e,i){window.console.log(e,i),t(s,e,i)}))}),"json").always((function(){l.removeClass("wpmui-loading")}))})),s.change((function(){var e=s.val();!isNaN(e)&&e>0?(l.find(".wpmui-label-after").show(),u.prop("disabled",!1).removeClass("disabled")):(l.find(".wpmui-label-after").hide(),u.prop("disabled",!0).addClass("disabled"))})),u.click((function(){var i={action:"transaction_update",_wpnonce:o.val(),id:m.val(),link:s.val()};if(!i.link)return!1;p.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,i,(function(i){"3"===i&&(e.removeClass("log-err").addClass("log-ok is-manual"),c.close())})).always((function(){p.removeClass("wpmui-loading")}))})),!isNaN(a.val())&&a.val()>0&&w()},t=function(e,i,a){if("object"==typeof a){var n=jQuery("<optgroup></optgroup>");n.attr("label",i),jQuery.each(a,(function(e,i){t(n,e,i)})),e.append(n)}else e.append(jQuery("<option></option>").val(i).html(a))},s.click((function(e){var i=jQuery(this).closest("td"),t=i.find("input[name=nonce_update]").val(),a=i.closest(".item"),n=a.attr("id").replace(/^item-/,""),s={};return!!a.hasClass("log-ignore")&&(s.action="transaction_update",s._wpnonce=t,s.id=n,s.state="clear",i.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,s,(function(e){a.removeClass("log-ignore is-manual").addClass("log-err")})).always((function(){i.removeClass("wpmui-loading")})),!1)})),r.click((function(e){var i=jQuery(this).closest("td"),t=i.find("input[name=nonce_update]").val(),a=i.closest(".item"),n=a.attr("id").replace(/^item-/,""),s={};return!!a.hasClass("log-err")&&(s.action="transaction_update",s._wpnonce=t,s.id=n,s.state="ignore",i.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,s,(function(e){a.removeClass("log-err").addClass("log-ignore is-manual")})).always((function(){i.removeClass("wpmui-loading")})),!1)})),o.click((function(e){var t=jQuery(this).closest("td"),a=t.find("input[name=nonce_link]").val(),n=t.closest(".item"),s=n.attr("id").replace(/^item-/,""),r={};return!!n.hasClass("log-err")&&(r.action="transaction_link",r._wpnonce=a,r.id=s,t.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,r,(function(e){e.length&&i(n,e)})).always((function(){t.removeClass("wpmui-loading")})),!1)})),d.click((function(e){var i=jQuery(this).closest("td"),t=i.find("input[name=nonce_retry]").val(),a=i.closest(".item"),n=a.attr("id").replace(/^item-/,""),s={};return!(!a.hasClass("log-err")&&!a.hasClass("log-ignore"))&&(s.action="transaction_retry",s._wpnonce=t,s.id=n,i.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,s,(function(e){e.success&&e.data.desc&&(a.removeClass("log-err log-ignore log-ok"),a.addClass("log-"+e.data.state),a.find(".column-note .txt").text(e.data.desc))}),"json").always((function(){i.removeClass("wpmui-loading")})),!1)})),l.click((function(i){var t=wpmUi.ajax().extract_data(n);return n.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,t,(function(i){i.success&&(wpmUi.message(i.data.message),e())}),"json").always((function(){n.removeClass("wpmui-loading")})),!1}))},window.ms_init.view_member_date=function(){jQuery(".ms-date").ms_datepicker()},window.ms_init.view_member_editor=function(){var e,i=jQuery("#username"),t=jQuery("#email"),a=jQuery(".ms-group-select #user_id"),n=jQuery("#btn_create"),s=jQuery("#btn_select"),r=jQuery("#payment_type"),o=jQuery("#subscription-status"),d={};function l(i,t){var a=t.val(),n={},s=t.closest(".wpmui-wrapper");n.action="member_validate_field",n.field=i,n.value=a,s.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,n,(function(i){var a=s.find(".wpmui-label-after");s.removeClass("wpmui-loading"),"1"===i?(t.removeClass("invalid"),t.addClass("valid"),a.html("")):(t.removeClass("valid"),t.addClass("invalid"),a.html(i)),e()}))}e=function(){i.hasClass("valid")&&t.hasClass("valid")?(n.prop("disabled",!1),n.removeClass("disabled")):(n.prop("disabled",!0),n.addClass("disabled")),a.val()?(s.prop("disabled",!1),s.removeClass("disabled")):(s.prop("disabled",!0),s.addClass("disabled"))},i.change((function(){l("username",i)})),t.change((function(){l("email",t)})),a.change(e),d.minimumInputLength=3,d.multiple=!1,d.ajax={url:window.ajaxurl,dataType:"json",type:"GET",delay:100,data:function(e){return{action:"member_search",q:e.term,p:e.page}},processResults:function(e,i){return{results:e.items,more:e.more}}},a.removeClass("wpmui-hidden"),a.wpmuiSelect(d),e(),o.on("change",(function(){"canceled"===o.val()&&"recurring"===r.val()&&window.alert(window.ms_admin_text.recurring_cancel_warning)}))},window.ms_init.view_member_list=function(){window.ms_init.memberships_column(".column-membership")},window.ms_init.view_membership_add=function(){var e=jQuery("input#public"),i=e.closest(".opt"),t=jQuery("input#paid"),a=jQuery("input#name"),n=a.closest(".opt"),s=t.closest(".opt");jQuery("#ms-choose-type-form").validate({onkeyup:!1,errorClass:"ms-validation-error",rules:{name:{required:!0}}}),jQuery('input[name="type"]').on("click",(function(){var r=jQuery('input[name="type"]'),o=r.filter(":checked"),d=o.val();r.closest(".wpmui-radio-input-wrapper").removeClass("active"),o.closest(".wpmui-radio-input-wrapper").addClass("active"),"guest"===d||"user"===d?(e.prop("disabled",!0),t.prop("disabled",!0),a.prop("readonly",!0),i.addClass("disabled ms-locked"),s.addClass("disabled ms-locked"),n.addClass("disabled ms-locked"),a.val(o.next(".wpmui-radio-caption").text())):(e.prop("disabled",!1),t.prop("disabled",!1),a.prop("readonly",!1),i.removeClass("disabled ms-locked"),s.removeClass("disabled ms-locked"),n.removeClass("disabled ms-locked"),a.val("").focus())})).filter(":checked").trigger("click"),jQuery("#cancel").on("click",(function(){var e=jQuery(this);e.on("ms-ajax-updated",(function(){window.location=ms_data.initial_url})),ms_functions.ajax_update(e)}))},window.ms_init.view_membership_list=function(){jQuery("#the-list-membership").on("click",".delete a",(function(e){var i,t=jQuery(this),a=t.parents("tr").find(".column-name .the-name").text(),n=t.attr("href");return e.preventDefault(),i={message:ms_data.lang.msg_delete.replace("%s",a),buttons:[ms_data.lang.btn_delete,ms_data.lang.btn_cancel],callback:function(e){0===e&&(window.location=n)}},wpmUi.confirm(i),!1})),jQuery(document).on("ms-ajax-form-done",(function(e,i,t,a,n){a||window.location.reload()}))},window.ms_init.bulk_delete_membership=function(){var e=jQuery(".bulk_delete_memberships_button").attr("href"),i=function(){var i=[];return jQuery("input.del_membership_ids:checked").each((function(){i.push(jQuery(this).val())})),i.length>0?e+"&membership_ids="+i.join("-"):e};jQuery(".bulk_delete_memberships_button").click((function(e){var t,a=jQuery(this);return a.parents("tr"),a.attr("href"),e.preventDefault(),t={message:ms_data.lang.msg_bulk_delete,buttons:[ms_data.lang.btn_delete,ms_data.lang.btn_cancel],callback:function(e){0===e&&(window.location=i())}},wpmUi.confirm(t),!1}))},window.ms_init.metabox=function(){var e=jQuery(".ms-protect-content"),i=jQuery(".ms-protection-rule"),t=jQuery("#ms-metabox-access-wrapper");e.hasClass("on")?t.show():t.hide(),jQuery(".dripped").on("click",(function(){jQuery(this).children(".tooltip").toggle(300)})),window.ms_init.ms_metabox_event=function(i,t){jQuery("#ms-metabox-wrapper").replaceWith(t.response),window.ms_init.metabox(),jQuery(".wpmui-radio-slider").on("click",(function(){window.ms_functions.radio_slider_ajax_update(this)})),e.on("ms-radio-slider-updated",(function(e,i){window.ms_init.ms_metabox_event(e,i)}))},e.on("ms-radio-slider-updated",(function(e,i){window.ms_init.ms_metabox_event(e,i)})),i.on("ms-radio-slider-updated",(function(a,n){i.filter(".on,.wpmui-loading").length?(t.show(),e.addClass("on")):(t.hide(),e.removeClass("on"))}))},window.ms_init.view_membership_overview=function(){jQuery(".wpmui-radio-slider").on("ms-radio-slider-updated",(function(){var e=jQuery("#ms-membership-status");jQuery(this).hasClass("on")?e.addClass("ms-active"):e.removeClass("ms-active")})),jQuery(document).on("ms-ajax-form-done",(function(e,i,t,a,n){a||window.location.reload()}))},window.ms_init.view_membership_urlgroup=function(){var e=!1;ms_functions.test_url=function(){e&&window.clearTimeout(e),e=window.setTimeout((function(){var e=jQuery("#url-test-results-wrapper"),i=jQuery.trim(jQuery("#url_test").val()),t=jQuery("#rule_value").val().split("\n"),a=jQuery("#is_regex").val();a="true"===a||"1"===a,e.empty().hide(),""!==i&&(jQuery.each(t,(function(t,n){var s,r;""!==(n=jQuery.trim(n))&&(s=jQuery("<div />").addClass("ms-rule-test"),jQuery("<span />").appendTo(s).text(n).addClass("ms-test-url"),r=jQuery("<span />").appendTo(s).addClass("ms-test-result"),!1,(a?new RegExp(n,"i").test(i):i.indexOf(n)>=0)?(s.addClass("ms-rule-valid"),r.text(ms_data.valid_rule_msg)):(s.addClass("ms-rule-invalid"),r.text(ms_data.invalid_rule_msg)),e.append(s))})),e.find("> div").length||e.html("<div><i>"+ms_data.empty_msg+"</i></div>"),e.show())}),500)},jQuery("#url_test, #rule_value").keyup(ms_functions.test_url)},window.ms_init.view_membership_payment=function(){function e(){var e=jQuery(this),i=e.closest(".ms-payment-form"),t=e.val(),a=i.find(".ms-payment-type-wrapper"),n=i.find(".ms-payment-type-"+t),s=i.find(".ms-payment-types-wrapper");a.hide(),n.show(),"permanent"===t?s.hide():s.show()}jQuery("#payment_type").change(e),jQuery("#payment_type").each(e),jQuery("#currency").change((function(){var e=jQuery(this).val(),i=jQuery(".ms-payment-structure-wrapper");switch(e){case"USD":e="$";break;case"EUR":e="&euro;";break;case"JPY":e="&yen;"}i.find(".wpmui-label-before").html(e)})),jQuery(".wpmui-slider-trial_period_enabled").on("ms-radio-slider-updated",(function(e,i,t){i.value?jQuery(".ms-trial-period-details").show():jQuery(".ms-trial-period-details").hide()})),jQuery(document).on("ms-ajax-updated","#enable_trial_addon",(function(e,i,t,a){a||(jQuery(".ms-specific-payment-wrapper").addClass("wpmui-loading"),window.location.reload())}))},window.ms_init.view_protected_content=function(){var e,i=jQuery(".wp-list-table"),t=jQuery("#select-site");function a(e){var i,t,a=jQuery(this).closest(".column-access"),n=a.closest("tr.item"),s=a.find("select.ms-memberships").val(),r=0;if(s&&s.length)for(i in s)t=s[i],void 0!==ms_data.dripped[t]&&(r+=1);r>1||1===r?n.addClass("ms-dripped"):n.removeClass("ms-dripped")}window.ms_init.memberships_column(".column-access"),e=function(e){var i=e.find("select.dripped_type"),t=e.find(".wpmui-datepicker");i.change((function(){var e=jQuery(this),i=e.val(),t=e.closest(".dripped-form").find(".drip-option");t.removeClass("active"),t.filter("."+i).addClass("active")})).trigger("change"),t.ms_datepicker()},i.on("ms-ajax-updated",".ms-memberships",a),i.find(".ms-memberships").each((function(){a.apply(this)})),jQuery(document).on("ms-inline-editor",(function(i,t,a,n){var s,r,o=a.find("select.ms-memberships option:selected"),d=t.find(".dripped-form"),l=t.find(".dynamic-form");for(s=0,r=o.length;s<r;s++){var u=jQuery(o[s]),m=u.val(),c=u.data("color"),p=d.clone(!1),w="ms_"+m;void 0!==ms_data.dripped[m]&&(p.find(".the-name").text(ms_data.dripped[m]).css({background:c}),p.find("[name=membership_ids]").attr("name","membership_ids[]").val(m),p.find("[name=item_id]").val(n.item_id),p.find("[name=offset]").val(n.offset),p.find("[name=number]").val(n.number),p.find("[name=dripped_type]").attr("name",w+"[dripped_type]").val(n[w+"[dripped_type]"]),p.find("[name=date]").attr("name",w+"[date]").val(n[w+"[date]"]),p.find("[name=delay_unit]").attr("name",w+"[delay_unit]").val(n[w+"[delay_unit]"]),p.find("[name=delay_type]").attr("name",w+"[delay_type]").val(n[w+"[delay_type]"]),p.appendTo(l).removeClass("hidden"),e(p))}d.remove()})),jQuery(document).on("ms-inline-editor-updated",(function(e,i){window.ms_init.memberships_column(".column-access"),i.find(".ms-memberships").each((function(){a.apply(this)}))})),t.on("change",(function(e){var i=t.val();window.location.href=i,t.addClass("wpmui-loading")}))},window.ms_init.memberships_column=function(e){var i=jQuery(".wp-list-table");function t(i){var t=jQuery(this).closest(e),a=t.closest("tr.item"),n=t.find("select.ms-memberships").val();t.removeClass("ms-focused"),n&&n.length||a.removeClass("ms-assigned").addClass("ms-empty")}i.on("click",".ms-empty-note-wrapper .wpmui-label-after",(function(i){var t=jQuery(this).closest(e),a=t.closest("tr.item"),n=t.find("select.ms-memberships");a.removeClass("ms-empty").addClass("ms-assigned"),t.addClass("ms-focused"),n.wpmuiSelect("focus"),n.wpmuiSelect("open")})),i.on("ms-ajax-updated",".ms-memberships",t),i.on("blur",".ms-memberships",(function(e){var i=jQuery(this);window.setTimeout((function(){t.apply(i,e)}),250)})),jQuery("select.ms-memberships").wpmuiSelect({templateResult:function(e){var i=e.element;return"<span "+('class="val" style="background: '+jQuery(i).data("color")+'"')+">&emsp;</span> "+e.text},templateSelection:function(e,i){var t=e.element;return i.css({background:jQuery(t).data("color")}),i.addClass("val"),'<span class="txt">'+e.text+"</span>"},escapeMarkup:function(e){return e},maximumSelectionLength:window.ms_admin_text.membership_multiple_limit,dropdownCssClass:"ms-memberships wpmui-select2",width:"100%",language:{maximumSelected:function(){return window.ms_admin_text.membership_multiple_message}}})},window.ms_init.view_membership_upgrade=function(){var e=jQuery(".ms-allow .wpmui-radio-slider");function i(){var e=jQuery(this),i=e.hasClass("on"),t=e.closest(".ms-allow").next(".ms-update-replace");t.length&&(i?t.hide():t.show())}e.on("ms-radio-slider-updated",i),e.each((function(){i.apply(this)}))},window.ms_init.view_addons=function(){var e=jQuery(".ms-addon-list");jQuery(document).on("list-filter",(function(e,i,t){if("options"===i)t.hide().filter(".ms-options").show()})),jQuery(document).on("ms-ajax-start",(function(i,t,a,n){n.removeClass("wpmui-loading"),e.addClass("wpmui-loading")})),jQuery(document).on("ms-ajax-updated",(function(e){var i=jQuery(e.target),t=i.closest(".list-card-top").find(".details").find(".wpmui-ajax-update-wrapper");i.hasClass("wpmui-ajax-update")||(i=i.find(".wpmui-ajax-update")),i.closest(".details").length||(i.hasClass("on")?t.removeClass("disabled"):t.addClass("disabled"))})),jQuery(document).on("ms-ajax-done",(function(i,t,a,n){e.removeClass("wpmui-loading")})),jQuery(".list-card-top .wpmui-ajax-update-wrapper").each((function(){jQuery(this).trigger("ms-ajax-updated")})),jQuery("#invoice_id_update").on("ms-ajax-updated",(function(){jQuery("#invoice_id_update").hide()})),jQuery("#invoice_sequence_type").on("ms-ajax-updated",(function(){var e=jQuery("#invoice_sequence_type").val();jQuery(".invoice-types").each((function(){jQuery(this).hide()})),jQuery("#"+e).length&&jQuery("#"+e).show()}))},window.ms_init.view_settings=function(){function e(e,i,t,a){var n=jQuery("select.wpmui-wp-pages"),s=n.map((function(){return jQuery(this).val()}));n.each((function(){var e,i=jQuery(this),t=i.find("option"),a=i.parents(".ms-settings-page-wrapper").first().find(".ms-action a"),n=i.val();for(t.prop("disabled",!1),e=0;e<s.length;e+=1)n!==s[e]&&t.filter('[value="'+s[e]+'"]').prop("disabled",!0);a.each((function(){var e=jQuery(this),i=e.data("wpmui-ajax").base+n;void 0===n||isNaN(n)||n<1?(e.addClass("disabled"),e.attr("href","")):(e.removeClass("disabled"),e.attr("href",i))}))}))}jQuery("#initial_setup").on("ms-ajax-updated",(function(){window.location=ms_data.initial_url})),jQuery(".wpmui-slider-plugin_enabled").on("ms-radio-slider-updated",(function(e,i){i.value?(jQuery("#wp-admin-bar-ms-unprotected").hide(),jQuery("#wp-admin-bar-ms-test-memberships").show()):(jQuery("#wp-admin-bar-ms-unprotected").show(),jQuery("#wp-admin-bar-ms-test-memberships").hide())})),jQuery(".wpmui-slider-enable_cron_use").on("ms-radio-slider-updated",(function(e,i){i.value?jQuery(".ms-settings-email-cron").show():jQuery(".ms-settings-email-cron").hide();var t=jQuery(".wpmui-slider-enable_cron_use .wpmui-toggle").attr("data-wpmui-ajax");t=JSON.parse(t),jQuery.post(window.ajaxurl,{action:"toggle_cron",_wpnonce:t._wpnonce},(function(){}))})),jQuery(".wpmui-wp-pages").on("ms-ajax-updated",e),jQuery(".ms-action a").on("click",(function(e){var i=jQuery(this);if(i.hasClass("disabled")||!i.attr("href").length)return e.preventDefault(),!1})),jQuery((function(){e()}))},window.ms_init.view_settings_automated_msg=function(){var e=!1;function i(){var e=jQuery(this),i=e.closest(".ms-settings-wrapper").find(".ms-editor-form");e.hasClass("on")?i.show():i.hide()}jQuery("#switch_comm_type").click((function(){var i=jQuery(this).closest("form"),t=0;for(t=0;t<window.tinymce.editors.length;t+=1)if(window.tinymce.editors[t].isDirty()){e=!0;break}if(e&&!window.confirm(ms_data.lang_confirm))return!1;i.submit()})),jQuery("input, select, textarea",".ms-editor-form").change((function(){e=!0})),jQuery(".override-slider").each((function(){i.apply(this)})).on("ms-ajax-done",i),window.tinymce.PluginManager.add("ms_variable",(function(e,i){var t,a,n=[];function s(){e.insertContent(this.value())}for(t in ms_data.var_button.items)ms_data.var_button.items.hasOwnProperty(t)&&(a=ms_data.var_button.items[t],n.push({text:a,value:t,onclick:s}));e.addButton("ms_variable",{text:ms_data.var_button.title,icon:!1,type:"menubutton",menu:n})}))},window.ms_init.view_settings_import=function(){var e=jQuery(".ms-settings-import"),i=e.find("#btn-download"),t=e.find("#btn-import"),a=e.find("#btn-user-import"),n=e.find("#clear_all"),s=e.find("#batchsize"),r=null,o=null,d=null,l=[],u=0;function m(){return void 0!==document.createElement("a").download&&(void 0!==window.Blob&&(void 0!==window.JSON&&void 0!==window.JSON.stringify))}function c(){var e=jQuery("<div></div>");o=wpmUi.progressbar(),e.append(o.$()),r=wpmUi.popup().title(ms_data.lang.progress_title,!1).modal(!0,!1).content(e,!0).size(600,140).show()}function p(){var e=jQuery('<div style="text-align:center"></div>'),i=jQuery('<a href="#" class="close"></a>');i.text(ms_data.lang.close_progress),ms_data.close_link&&i.attr("href",ms_data.close_link),i.addClass("button-primary"),i.appendTo(e),r.content(e,!0).modal(!0,!0).title(ms_data.lang.import_done)}function w(e){var i,t={},a=0;for(t.items=[],t.item_count=0,t.label="",t.source=window._ms_import_obj.source_key,void 0!==window._ms_import_obj.membership&&(t.membership=window._ms_import_obj.membership),void 0!==window._ms_import_obj.status&&(t.status=window._ms_import_obj.status),void 0!==window._ms_import_obj.start&&(t.start=window._ms_import_obj.start),void 0!==window._ms_import_obj.expire&&(t.expire=window._ms_import_obj.expire),a=0;a<e&&void 0!==(i=l.shift());a+=1)t.label=i.label,delete i.label,t.items.push(i),t.item_count+=1;return t}function f(){var e=w(s.val());e.item_count?(o.value(u-l.length).label('<i class="wpmui-loading-icon"></i> <span>'+e.label+"</span>"),d||(d=t.length?t.val():a.val()),e.action=d,delete e.label,jQuery.post(window.ajaxurl,e,f)):p()}m()?i.click((function(){void 0!==window._ms_import_obj&&function(e,i,t){var a,n;if(!m())return!1;t||(t="application/octet-stream"),a=document.createElement("a"),n=new window.Blob([e],{type:t}),a.href=window.URL.createObjectURL(n),a.download=i,a.trigger("click")}(window.JSON.stringify(window._ms_import_obj),"protected-content.json")})):i.hide(),t.click((function(){var e,i,t,a=ms_data.lang;for(e in(l=[]).push({task:"start",clear:n.is(":checked"),label:a.task_start}),t=0,window._ms_import_obj.memberships)i=window._ms_import_obj.memberships[e],t+=1,l.push({task:"import-membership",data:i,label:a.task_import_membership+": "+t+"..."});for(e in t=0,window._ms_import_obj.members)i=window._ms_import_obj.members[e],t+=1,l.push({task:"import-member",data:i,label:a.task_import_member+": "+t+"..."});for(e in window._ms_import_obj.settings)i=window._ms_import_obj.settings[e],l.push({task:"import-settings",setting:e,value:i,label:a.task_import_settings+"..."});l.push({task:"done",label:a.task_done}),c(),u=l.length,o.max(u),f()})),a.click((function(){var e,i,t,r,d,m,_,v,h=ms_data.lang;for(e in(l=[]).push({task:"start",clear:n.is(":checked"),label:h.task_start}),t=0,window._ms_import_obj.users)i=window._ms_import_obj.users[e],r=window._ms_import_obj.membership,d=window._ms_import_obj.status,m=window._ms_import_obj.start,_=window._ms_import_obj.expire,t+=1,l.push({task:"import-member",data:i,membership:r,status:d,start:m,expire:_,label:h.task_import_member+": "+t+"..."});l.push({task:"done",label:h.task_done}),c(),u=l.length,o.max(u),(v=w(s.val())).item_count?(o.value(u-l.length).label('<i class="wpmui-loading-icon"></i> <span>'+v.label+"</span>"),v.action=a.val(),delete v.label,jQuery.post(window.ajaxurl,v,f)):p()})),jQuery(document).on("change","select.ms-select-type",(function(){jQuery(".ms-select-format-wrapper").is(":visible")||jQuery(".ms-select-format-wrapper").show(),"plugin"===jQuery(this).val()&&jQuery(".ms-select-format-wrapper").hide()})),jQuery(".ms-select-format-wrapper").hide()},window.ms_init.view_settings_mailchimp=function(){jQuery("#mailchimp_api_key").on("ms-ajax-updated",ms_functions.reload)},window.ms_init.view_settings_media=function(){jQuery("#direct_access").on("ms-ajax-updated",(function(){var e=jQuery("#direct_access").val();if(e){var i=e.split(","),t="location ~* ^"+jQuery("#wp_content_dir").val()+"/.*\\.("+i.join("|")+")$ { \n  allow all;\n}";jQuery(".application-servers-nginx-extra-instructions").html(escapeHtml(t))}})),jQuery("#application_server").on("ms-ajax-updated",(function(){var e=jQuery("#application_server").val();jQuery(".application-servers").each((function(){jQuery(this).hide()})),jQuery(".application-server-"+e).show()}))},window.ms_init.view_settings_payment=function(){function e(){var e=jQuery("#secure_cc").val();"false"!==e&&e?(jQuery(".secure_cc_off").hide(),jQuery(".secure_cc_on").removeClass("hidden").show()):(jQuery(".secure_cc_on").hide(),jQuery(".secure_cc_off").removeClass("hidden").show())}jQuery(document).on("ms-ajax-updated",(function(e,i,t,a){if(void 0!==i.gateway_id&&"update_gateway"===i.action){var n=jQuery(".gateway-"+i.gateway_id);a?n.removeClass("is-configured is-live is-sandbox").addClass("not-configured"):(n.removeClass("not-configured").addClass("is-configured"),"sandbox"===i.value?n.removeClass("is-live").addClass("is-sandbox"):"live"===i.value&&n.removeClass("is-sandbox").addClass("is-live"))}})),jQuery(document).on("click",".show-settings",(function(e){var i=jQuery(this),t=i.closest(".ms-gateway-item");i.prop("checked")?t.addClass("open"):t.removeClass("open")})),jQuery(".wpmui-slider-secure_cc").on("ms-ajax-done",e),e()},window.ms_init.view_settings_protection=function(){function e(){var e=jQuery(this),i=e.closest(".inside"),t=i.find(".wp-editor-wrap"),a=i.find(".button-primary");e.hasClass("on")?(a.show(),t.show()):(a.hide(),t.hide())}jQuery(".button-primary.wpmui-ajax-update").data("before_ajax",(function(e,i){var t=jQuery("#"+e.type),a=t.closest(".wp-editor-wrap"),n=window.tinyMCE.get(e.type);return n&&a.hasClass("tmce-active")&&n.save(),e.value=t.val(),e})),jQuery(".override-slider").each((function(){e.apply(this)})).on("ms-ajax-done",e)},window.ms_init.view_settings_setup=function(){var e=jQuery(".ms-setup-pages-site"),i=e.find(".ms-setup-pages-site-form"),t=e.find(".ms-setup-pages-change-site"),a=e.find(".ms-setup-pages-cancel");jQuery(document).on("ms-ajax-updated","#create_menu",(function(e,i,t,a){var n;a||void 0!==(n=t.split(":"))[1]&&(n.shift(),jQuery(".ms-nav-controls").replaceWith(n.join(":")))})),t.click((function(e){return i.show(),t.hide(),!1})),a.click((function(e){return i.hide(),t.show(),!1}))};